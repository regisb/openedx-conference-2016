<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Open edX 101: A Source Code Review</title>

		<meta name="description" content="Open edX 101: A Source Code Review | Régis Behmo, Open edX Conference, June 14 2016 | Stanford, CA">
		<meta name="author" content="Régis Behmo">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/night.css" id="theme">
		<link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="icon" type="image/x-icon" href="img/favicon.ico" />

		<!-- Code syntax highlighting -->
        <link rel="stylesheet" href="lib/css/gruvbox-dark.css">
        <!--<link rel="stylesheet" href="lib/css/zenburn.css">-->
        <!--<link rel="stylesheet" href="lib/css/solarized-dark.css">-->

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

        <style>
            .reveal .slide-number {
                font-size: 25px;
                font-weight: bold;
            }
            .full-width {
                width: 100%;
            }
            .reveal .dim p:not(.undim) {
                color: #837E7E;
            }
            .table {
                display: table;
            }
            .table-row {
                display: table-row;
            }
            .table-cell {
                display: table-cell;
            }
            .reveal .sidespace {
                margin-left: 20px;
                margin-right: 20px;
            }
            .reveal .bottom-border {
                border-bottom: 2px solid white;
            }
            .reveal .green {
                color: #17ff2e;
            }
            .reveal .orange {
                color: orange;
            }
            .reveal .right-border {
                border-right: 2px solid white;
            }

            .reveal div .d3-label {
              font: 20px sans-serif;
              position: absolute;
            }
            .reveal .shadowed {
              text-shadow: 0 0 4px #000;
            }

            .reveal pre.large {
                font-size: 80%;
            }
            .reveal pre.medium {
                font-size: 60%;
            }

            /*Make all fontawesome icons the same size in pre*/
            .reveal pre i.fa {
                width: 20px;
            }
        </style>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Open edX 101</h1>
					<h3>A Source Code Review</h3>
					<p><a href="http://minutebutterfly.com">Régis Behmo</a> (<a href="http://github.com/regisb">@regisb</a>) <br>
                    Open edX Conference, June 14 2016 | Stanford, CA<br>
                    <a href="https://www.fun-mooc.com">fun-mooc.com</a>
                    </p>
                    <img src="./img/orlando.png" width="50px" alt="Orlando" style="border: none; background: none;">
                </section>

                <section>
                    <img src="./img/fun-mooc.png" alt="fun-mooc.fr" height="550px;">
                    <p><a href="https://www.fun-mooc.fr">https://www.fun-mooc.fr</a><br>
                    350 courses, 700 000 users
                    </p>
				</section>

                <section>
                </section>

                <section>
                    <h3>Open edX from above</h3>

<pre class="fragment" style="font-size: 90%;"><span class="fragment highlight-green"># LMS + CMS
/edx/app/edxapp/edx-platform</span>

# Forum service (Ruby code)
/edx/app/forum/cs_comments_service

# Programs-based product lines such as edX's XSeries offering.
/edx/app/programs/programs

# Payment services (seldom installed)
/edx/app/ecommerce/ecommerce
/edx/app/ecomworker/ecomworker

# Theme customization (optional)
/edx/app/edxapp/themes
                    
# Python virtual environment for edx-platform dependencies
/edx/app/edxapp/venvs/edxapp
    ...
</pre>
				</section>
    
                <section>
                    <h3>Open edX from above</h3>
                    <h4>edx-platform</h4>
                    <p>How many lines of code in edx-platform? (1 Dj = 1 Django)</p>
                    <ul style="width: 80%;">
                        <li>CPython 3.5.1 (Python, C, C++) <span style="float: right;">967 725 # 4.23 Dj</span></li>
                        <li>Moodle (php) <span style="float: right;">672 331 # 2.94 Dj</span></li>
                        <li>ElasticSearch (Java) <span style="float: right;">590 318 # 2.58 Dj</span></li>
                        <li>Wordpress (php) <span style="float: right;">291 709 # 1.28 Dj</span></li>
                        <li>Django <span style="float: right;">228 381 # 1 Dj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
                        <li>Sentry <span style="float: right;">175 073 # 0.77 Dj</span></li>
                        <li>Mercurial <span style="float: right;">122 671 # 0.54 Dj</span></li>
                        <li>Celery <span style="float: right;">44 022 # 0.19 Dj</span></li>
                        <li>Flask <span style="float: right;">9 072 # 0.04 Dj</span></li>
                    </ul>
                </section>

                <section>
                    <h3>Open edX from above</h3>
                    <h4>edx-platform</h4>
                    <p>How many lines of code in edx-platform? (1 Dj = 1 Django)</p>
                    <ul style="width: 80%;">
                        <li>CPython 3.5.1 (Python, C, C++) <span style="float: right;">967 725 # 4.23 Dj</span></li>
                        <li>Moodle (php) <span style="float: right;">672 331 # 2.94 Dj</span></li>
                        <li>ElasticSearch (Java) <span style="float: right;">590 318 # 2.58 Dj</span></li>
                        <li class="green">edx-platform <span style="float: right;">427 321 # 1.87 Dj</span></li>
                        <li>Wordpress (php) <span style="float: right;">291 709 # 1.28 Dj</span></li>
                        <li>Django <span style="float: right;">228 381 # 1 Dj&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li>
                        <li>Sentry <span style="float: right;">175 073 # 0.77 Dj</span></li>
                        <li>Mercurial <span style="float: right;">122 671 # 0.54 Dj</span></li>
                        <li>Celery <span style="float: right;">44 022 # 0.19 Dj</span></li>
                        <li>Flask <span style="float: right;">9 072 # 0.04 Dj</span></li>
                    </ul>
                </section>

                <section>
                    <h3>Inside edx-platform</h3>
<!--Command run was: cloc --exclude-list-file=./cloc_exclude --exclude-dir=node_modules,./common/static/fonts/vendor,./common/static/js/vendor,./common/static/css/vendor,./cms/static/sass/vendor,./lms/static/js/vendor,./lms/static/sass/vendor,./lms/static/css/vendor,./static/vendor,vendor_extra/ $1-->
<pre style="text-align:center;" class="large"><code class="bash">cloc --exclude-dir=&lt;vendor-folders&gt; edx-platform</code></pre>
<pre style="font-size: 70%;">-------------------------------------------------------------------------------
Language                     files          blank        comment           code
-------------------------------------------------------------------------------
Python                        1791          64982          98146         244140 # 57.1%
Javascript                     718          13745          10806          79920 # 18.7%
SASS                           300          10054           3769          43727 # 10.2%
HTML                           493           4716          30435          27928 # 6.5%
CoffeeScript                   118           2660           1459          14558 # 3.4%
CSS                             12            510            461           6675 # 1.5%
SQL                              2              8              9           4137
XML                            286            172             33           3451
YAML                            40            270            367           1827
Bourne Shell                    13            219            222            700
make                             2             31              6            143
ActionScript                     1             21             23             74
XSD                              1              8              0             41
-------------------------------------------------------------------------------
SUM:                          3777          97396         145736         <span class="green">427321</span>
-------------------------------------------------------------------------------</pre>
                </section>

                <section>
                    <section data-state="edx-platform-cloc">
                        <div id="edx-platform-cloc" class="cloc"></div>
                        <p class="module-cloc" style="position: absolute; top: 0; left: 0; text-align: left;"></p>
                    </section>
                    <section data-state="edx-platform-cloc">
                        <div id="lms-platform-cloc" class="cloc"></div>
                        <p class="module-cloc" style="position: absolute; top: 0; left: 0; text-align: left;"></p>
                    </section>
                    <section data-state="edx-platform-cloc">
                        <div id="cms-platform-cloc" class="cloc"></div>
                        <p class="module-cloc" style="position: absolute; top: 0; left: 0; text-align: left;"></p>
                    </section>
                    <section data-state="edx-platform-cloc">
                        <div id="common-platform-cloc" class="cloc"></div>
                        <p class="module-cloc" style="position: absolute; top: 0; left: 0; text-align: left;"></p>
                    </section>
				</section>

                <section>
                    <h3>Inside edx-platform</h3>
<pre style="font-size: 90%;"># LMS + CMS
/edx/app/edxapp/edx-platform       # 427321

# Forum service (Ruby code)
/edx/app/forum/cs_comments_service # 5399

# Programs-based product lines such as edX's XSeries offering.
/edx/app/programs/programs         # 4906

# Payment services (seldom installed)
/edx/app/ecommerce/ecommerce       # 25670
/edx/app/ecomworker/ecomworker     # 643

# Theme customization (optional)
/edx/app/edxapp/themes
                    
# Python virtual environment
<span class="fragment highlight-green">/edx/app/edxapp/venvs/edxapp</span>
</pre>
                </section>
                <section>
                    <h3>Inside edx-platform</h3>
                    <h4>dependencies</h4>
<pre style="font-size: 90%;">
<span class="green">/edx/app/edxapp/venvs/edxapp</span>
    ora2                        # 31245
    edx-search                  # 3321
    opaque-keys                 # 3089
    recommender-xblock          # 3001
    xblock-poll                 # 2194
    edx-submissions             # 2193
    edx-milestones              # 1953
    event-tracking              # 1777
    edx-sga                     # 1567
    edx-reverification-block    # 1418
    xblock-google-drive         # 1261
    edx-user-state-client       # 1083
    ccx-keys                    # 748
    rate-xblock                 # 598
    acid-xblock                 # 750
    edx-jsme                    # 607
    done-xblock                 # 534
</pre>
                </section>

                <section>
                    <h3>Open edX from the inside</h3>
                    <h4 class="fragment">Viewing a course</h4>
                </section>

                <section>
                    <h3>Open edX from the inside</h3>
                    <h4>Viewing a course</h4>
<pre class="fragment large" style="width: 100%;"><code class="bash">$ curl -L https://raw.github.com/edx/configuration/.../Vagrantfile > Vagrantfile
$ OPENEDX_RELEASE="named-release/dogwood.3" vagrant up && vagrant ssh
$ sudo su edxapp
$ paver devstack lms
...
Starting development server at http://0.0.0.0:8000/
</code></pre>
                </section>

                <section data-background-image="./img/lms_lesson1.png">
                </section>
                <section data-background-image="./img/lms_lesson1_url.png">
                </section>

                <section>
                    <h3>Open edX from the inside</h3>
                    <h4>Viewing a course</h4>
                    <img src="./img/lms_lesson1_url_alone.png" alt="courseware url" width="100%">
<pre class="large">lms/urls.py:</pre>
<pre class="large">url(
    r'^courses/{}/courseware/(?P&lt;chapter&gt;[^/]*)/(?P&lt;section&gt;[^/]*)/$'.format(
        settings.COURSE_ID_PATTERN,
    ),
    <span class="fragment highlight-green">'courseware.views.index',</span>
    name='courseware_section',
)</pre>
                </section>

                <section>
                    <h3>Open edX from the inside</h3>
                    <h4>Viewing a course</h4>
<pre class="large">lms/djangoapps/courseware/views.py:</pre>
<pre class="large">def index(request, course_id, chapter, section):
    ...
    <span class="fragment highlight-green">course = get_course_with_access(..., course_key, ...)</span>
    <span class="fragment highlight-blue">section_module</span> = get_module_for_descriptor(
        user,
        request,
        section_descriptor,
        field_data_cache,
        course_key,
        position,
        <span class="fragment highlight-green">course=course</span>
    )</pre>
                </section>

                <section>
<pre class="medium"><span class="fragment">pprint(course.__class__.__mro__) # class and all base classes of 'course'</span>
<span class="fragment">(&lt;class '<span class="fragment highlight-green">xblock.internal.CourseDescriptorWithMixins</span>'&gt;,
 &lt;class 'xmodule.course_module.CourseDescriptor'&gt;,
 &lt;class 'xmodule.course_module.CourseFields'&gt;,
 &lt;class 'xmodule.seq_module.SequenceDescriptor'&gt;,
 &lt;class 'xmodule.seq_module.SequenceFields'&gt;,
 &lt;class 'xmodule.seq_module.ProctoringFields'&gt;,
 &lt;class 'xmodule.mako_module.MakoModuleDescriptor'&gt;,
 &lt;class 'xmodule.mako_module.MakoTemplateBlockBase'&gt;,
 &lt;class 'xmodule.xml_module.XmlDescriptor'&gt;,
 &lt;class 'xmodule.xml_module.XmlParserMixin'&gt;,
 &lt;class 'xmodule.x_module.XModuleDescriptor'&gt;,
 &lt;class 'xmodule.x_module.HTMLSnippet'&gt;,
 &lt;class 'xmodule.x_module.ResourceTemplates'&gt;,
 &lt;class 'lms.djangoapps.lms_xblock.mixin.LmsBlockMixin'&gt;,
 &lt;class 'xmodule.modulestore.inheritance.InheritanceMixin'&gt;,
 &lt;class 'xmodule.x_module.XModuleMixin'&gt;,
 &lt;class 'xmodule.x_module.XModuleFields'&gt;,
 &lt;class 'xblock.core.XBlock'&gt;,
 &lt;class 'xblock.mixins.XmlSerializationMixin'&gt;,
 &lt;class 'xblock.mixins.HierarchyMixin'&gt;,
 &lt;class 'xmodule.mixin.LicenseMixin'&gt;,
 &lt;class 'xmodule.modulestore.edit_info.EditInfoMixin'&gt;,
 &lt;class 'xblock.XBlockMixin'&gt;,
 &lt;class 'xblock.core.XBlockMixin'&gt;,
 &lt;class 'xblock.mixins.ScopedStorageMixin'&gt;,
 &lt;class 'xblock.mixins.RuntimeServicesMixin'&gt;,
 &lt;class 'xblock.mixins.HandlersMixin'&gt;,
 &lt;class 'xblock.mixins.IndexInfoMixin'&gt;,
 &lt;class 'xblock.mixins.ViewsMixin'&gt;,
 &lt;class 'xblock.core.SharedBlockBase'&gt;,
 &lt;class 'xblock.plugin.Plugin'&gt;,
 &lt;type 'object'&gt;)</span>
</pre>
                </section>

                <section>
                    <h3>Open edX from the inside</h3>
                    <h4>Viewing a course</h4>
                    <pre class="fragment medium" style="text-align: center;">http://.../courses/...edX+DemoX+Demo_Course/courseware/interactive_demonstrations/19a30.../</pre>
                    <i class="fa fa-arrow-down fragment"></i>
                    <pre class="fragment large" style="text-align: center;">courseware.views.index</pre>
                    <i class="fa fa-arrow-down fragment"></i>
                    <pre class="fragment large" style="text-align: center;">course = get_course_with_access(...)</pre>
                    <i class="fa fa-arrow-down fragment"></i>
                    <pre class="fragment large" style="text-align: center;">xblock.internal.CourseDescriptorWithMixins</pre>
                    <i class="fa fa-arrow-down fragment"></i>
                    <pre class="fragment large" style="text-align: center;">?</pre>
                </section>

                <section>
                    <h3>Btw, what is a mixin?</h3>
                    <div class="fragment">
                        <blockquote>Wikipedia: "In object-oriented programming languages, a mixin is a class that contains methods for use by other classes"</blockquote>
                    </div>
<pre class="fragment medium"><code class="python" style="max-height: none;">class Shape(object):
    def __init__(self):
        self.edges = []

    def perimeter(self):
        return sum([e.size for e in self.edges])

class Square(Shape):
    def __init__(self):
        self.edges = make_square()

class Triangle(Shape):
    def __init__(self):
        self.edges = make_triangle()

class ColorMixin(object):
    def colorize(self, color):
        for edge in self.edges:
            edge.color = color

class ColoredSquare(Square, ColorMixin):
    pass</code></pre>
                </section>

                <section>
<pre class="medium">pprint(course.__class__.__mro__) # class and all base classes of 'course'
(&lt;class '<span class="green">xblock.internal.CourseDescriptorWithMixins</span>'&gt;,
 &lt;class '<span class="fragment highlight-green">xmodule.course_module.CourseDescriptor</span>'&gt;,
 &lt;class 'xmodule.course_module.CourseFields'&gt;,
 &lt;class 'xmodule.seq_module.SequenceDescriptor'&gt;,
 &lt;class 'xmodule.seq_module.SequenceFields'&gt;,
 &lt;class 'xmodule.seq_module.ProctoringFields'&gt;,
 &lt;class 'xmodule.mako_module.MakoModuleDescriptor'&gt;,
 &lt;class 'xmodule.mako_module.MakoTemplateBlockBase'&gt;,
 &lt;class 'xmodule.xml_module.XmlDescriptor'&gt;,
 &lt;class 'xmodule.xml_module.XmlParserMixin'&gt;,
 &lt;class 'xmodule.x_module.XModuleDescriptor'&gt;,
 &lt;class 'xmodule.x_module.HTMLSnippet'&gt;,
 &lt;class 'xmodule.x_module.ResourceTemplates'&gt;,
 &lt;class 'lms.djangoapps.lms_xblock.mixin.LmsBlockMixin'&gt;,
 &lt;class 'xmodule.modulestore.inheritance.InheritanceMixin'&gt;,
 &lt;class 'xmodule.x_module.XModuleMixin'&gt;,
 &lt;class 'xmodule.x_module.XModuleFields'&gt;,
 &lt;class 'xblock.core.XBlock'&gt;,
 &lt;class 'xblock.mixins.XmlSerializationMixin'&gt;,
 &lt;class 'xblock.mixins.HierarchyMixin'&gt;,
 &lt;class 'xmodule.mixin.LicenseMixin'&gt;,
 &lt;class 'xmodule.modulestore.edit_info.EditInfoMixin'&gt;,
 &lt;class 'xblock.XBlockMixin'&gt;,
 &lt;class 'xblock.core.XBlockMixin'&gt;,
 &lt;class 'xblock.mixins.ScopedStorageMixin'&gt;,
 &lt;class 'xblock.mixins.RuntimeServicesMixin'&gt;,
 &lt;class 'xblock.mixins.HandlersMixin'&gt;,
 &lt;class 'xblock.mixins.IndexInfoMixin'&gt;,
 &lt;class 'xblock.mixins.ViewsMixin'&gt;,
 &lt;class 'xblock.core.SharedBlockBase'&gt;,
 &lt;class 'xblock.plugin.Plugin'&gt;,
 &lt;type 'object'&gt;)
</pre>
                </section>

                <section>
                    <h3>Open edX from the inside</h3>
                    <h4>Viewing a course</h4>
                    <div class="fragment">
<pre class="large">xblock/runtime.py:</pre>
<pre class="large"><code class="python">class Mixologist(object):
    def __init__(self, mixins):
        self._mixins = tuple(mixins)

    def mix(self, cls):
        ...
        return type(
            base_class.__name__ + 'WithMixins',   # class name
            (base_class, ) + self._mixins,        # class bases
            {'unmixed_class': base_class}         # class attributes
        )
</code></pre>
                    </div>
                </section>
                <section data-background-image="./img/mixologist.png">
                </section>

                <section>
                    <h3>Open edX from the inside</h3>
                    <h4>Viewing a course</h4>
<pre class="large">xblock/runtime.py:</pre>
<pre class="large"><code class="python">class Mixologist(object):
    def __init__(self, mixins):
        self._mixins = tuple(mixins)

    def mix(self, cls):
        ...
        return type(
            base_class.__name__ + 'WithMixins',   # class name
            (base_class, ) + self._mixins,        # class bases
            {'unmixed_class': base_class}         # class attributes
        )
</code></pre>
                    <div class="fragment">
<pre class="large">common/lib/xmodule/xmodule/modulestore/__init__.py:</pre>
<pre class="large"><code class="python">mixologist = Mixologist(settings.XBLOCK_MIXINS)</code></pre>
                    </div>
                </section>

                <section>
                    <h3>Open edX from the inside</h3>
                    <h4>Viewing a course</h4>
<pre class="large">lms/envs/common.py
cms/envs/common.py</pre>
<pre class="large"><code class="python fragment"># These are the Mixins that should be added to every XBlock.
# This should be moved into an XBlock Runtime/Application object
# once the responsibility of XBlock creation is moved out of modulestore</code></pre>
<pre class="large"><code class="python">XBLOCK_MIXINS = (
    LmsBlockMixin,
    InheritanceMixin,
    XModuleMixin,
    EditInfoMixin,
    AuthoringMixin, # (In the CMS only)
)</code></pre>
                </section>

                <section>
                    <h3>Open edX from the inside</h3>
                    <h4>Viewing a course</h4>
<pre class="large"><code class="python"># These are the Mixins that should be added to every XBlock.
# This should be moved into an XBlock Runtime/Application object
# once the responsibility of XBlock creation is moved out of modulestore</code></pre>
<ol>
    <li class="fragment">What is an "XBlock"?</li>
    <li class="fragment">What is an "XBlock Runtime/Application"?</li>
    <li class="fragment">What is a "modulestore"?</li>
</ol>
                </section>

                <section>
                    <h3>XBlocks from the inside</h3>
                    <div class="fragment">
                        <p>General explanation of Open edX and XBlocks (2013) (2'24): <a href="https://www.youtube.com/watch?v=dTS-nsf7d3Q">https://www.youtube.com/watch?v=dTS-nsf7d3Q</a></p>
                        <p>"XBlocks all the way down" -- Ned Batchelder, Appsembler webinar (15'): <a href="http://www.appsembler.com/blog/open-edx-xblocks-webinar/">http://www.appsembler.com/blog/open-edx-xblocks-webinar/</a></p>
                    </div>

                    <p><span class="fragment">Examples: </span><span class="fragment">course</span><span class="fragment">, poll</span><span class="fragment">, peer assessed exams</span><span class="fragment">,<br>jsme (molecule editor)</span><span class="fragment">...</span></p>

                    <p class="fragment">The xblock directory: <del>http://xblocks.com</del> <a href="http://xblocks.org/">http://xblocks.org/</a></p>
                </section>

                <section data-background-image="./img/xblocks.com.png"></section>

                <section>
                    <h3>XBlocks from the inside</h3>
                    <p class="fragment">"XBlocks all the way down" -- Ned Batchelder</p>
                </section>
                <section data-background-image="./img/turtles.jpg">
                    <h3 class="shadowed">XBlocks from the inside</h3>
                    <p class="shadowed">"XBlocks all the way down" -- Ned Batchelder</p>
                </section>

                <section>
<pre class="medium">pprint(course.__class__.__mro__) # class and all base classes of 'course'
(&lt;class '<span class="fragment highlight-green">xblock.internal.CourseDescriptorWithMixins</span>'&gt;,
 &lt;class 'xmodule.course_module.CourseDescriptor'&gt;,
 &lt;class 'xmodule.course_module.CourseFields'&gt;,
 &lt;class 'xmodule.seq_module.SequenceDescriptor'&gt;,
 &lt;class 'xmodule.seq_module.SequenceFields'&gt;,
 &lt;class 'xmodule.seq_module.ProctoringFields'&gt;,
 &lt;class 'xmodule.mako_module.MakoModuleDescriptor'&gt;,
 &lt;class 'xmodule.mako_module.MakoTemplateBlockBase'&gt;,
 &lt;class 'xmodule.xml_module.XmlDescriptor'&gt;,
 &lt;class 'xmodule.xml_module.XmlParserMixin'&gt;,
 &lt;class 'xmodule.x_module.XModuleDescriptor'&gt;,
 &lt;class 'xmodule.x_module.HTMLSnippet'&gt;,
 &lt;class 'xmodule.x_module.ResourceTemplates'&gt;,
 &lt;class 'lms.djangoapps.lms_xblock.mixin.LmsBlockMixin'&gt;,
 &lt;class 'xmodule.modulestore.inheritance.InheritanceMixin'&gt;,
 &lt;class 'xmodule.x_module.XModuleMixin'&gt;,
 &lt;class 'xmodule.x_module.XModuleFields'&gt;,
 &lt;class '<span class="fragment highlight-green">xblock.core.XBlock</span>'&gt;,
 &lt;class 'xblock.mixins.XmlSerializationMixin'&gt;,
 &lt;class 'xblock.mixins.HierarchyMixin'&gt;,
 &lt;class 'xmodule.mixin.LicenseMixin'&gt;,
 &lt;class 'xmodule.modulestore.edit_info.EditInfoMixin'&gt;,
 &lt;class 'xblock.XBlockMixin'&gt;,
 &lt;class 'xblock.core.XBlockMixin'&gt;,
 &lt;class 'xblock.mixins.ScopedStorageMixin'&gt;,
 &lt;class 'xblock.mixins.RuntimeServicesMixin'&gt;,
 &lt;class 'xblock.mixins.HandlersMixin'&gt;,
 &lt;class 'xblock.mixins.IndexInfoMixin'&gt;,
 &lt;class 'xblock.mixins.ViewsMixin'&gt;,
 &lt;class 'xblock.core.SharedBlockBase'&gt;,
 &lt;class 'xblock.plugin.Plugin'&gt;,
 &lt;type 'object'&gt;)
</pre>
                </section>

                <section>
                    <h3>XBlocks from the inside</h3>
                    <p>XBlock-poll: "A user-friendly way to query students."<br><a href="https://github.com/open-craft/xblock-poll">https://github.com/open-craft/xblock-poll</a></p>
<pre class="medium fragment" data-fragment-index="1">poll/poll.py:</pre>
<pre class="medium"><code class="fragment python" data-fragment-index="5">@XBlock.wants('settings')</code><code class="fragment python" data-fragment-index="2">class PollBlock(XBlock):</code><code class="python fragment" data-fragment-index="4">
    answers = List(scope=Scope.settings, help="The answer options on this poll.")
    choice = String(scope=Scope.user_state, help="The student's answer")
    ...</code><code class="fragment python" data-fragment-index="3">
    def studio_view(self):
        ...
        return xblock.fragment.Fragment(some_html_code)</code><code class="fragment python" data-fragment-index="6">
    def img_alt_mandatory(self):
        """
        Determine whether alt attributes for images are configured to be mandatory.
        """
        settings_service = self.runtime.service(self, "settings")
        if not settings_service:
            return True
        xblock_settings = settings_service.get_settings_bucket(self)
        return xblock_settings.get('IMG_ALT_MANDATORY', True)</code>
</pre>
                </section>

                <section>
                    <h3>XBlock runtimes</h3>
                    <p>Runtime responsibilities:</p>
                    <p class="large fragment">1. Instantiate xblocks</p>
<pre class="large"><code class="python fragment">class XBlock(...):
    def __init__(self, runtime, ...):
        ...</code></pre>

<pre class="large"><code class="python fragment">class Runtime(object):
    def construct_xblock_from_class(self, cls, scope_ids,
                                    field_data=None, *args, **kwargs):
        return self.mixologist.mix(cls)(runtime=self, scope_ids=scope_ids,
                                        field_data=field_data, *args, **kwargs)</code></pre>

                        <p class="fragment">2. Provide service to xblocks</p>
<pre class="large"><code class="python fragment">settings_service = self.runtime.service(self, "settings")</code></pre>
                </section>
                <section>
                    <h3>XBlock runtimes</h3>
                    <h4>XBlock serialization/deserialization ('field-data' service)</h4>
<div class="fragment"><pre>xblock/core.py:</pre>
<pre><code class="python">class XBlock(..., ScopedStorageMixin, ...):
    ...</code></pre></div>

<div class="fragment"><pre>xblock/mixins.py:</pre>
<pre><code class="python">@RuntimeServicesMixin.needs('field-data')
class ScopedStorageMixin(...):     
    @property
    def _field_data(self):
        return self.runtime.service(self, 'field-data')

    def force_save_fields(self, field_names):
        ...
        self._field_data.set_many(self, fields_to_save_json)</code></pre></div>

<div class="fragment"><pre>xblock/fields.py:</pre>
<pre><code class="python">class Field(...):
    def __get__(self, xblock, ...):
        field_data = xblock._field_data

        if field_data.has(xblock, self.name):
            return value = self.from_json(field_data.get(xblock, self.name))
        else: ...</code></pre></div>
                </section>

                <section>
                    <h3>XBlock runtimes</h3>
                    <h4>XBlock serialization/deserialization ('field-data' service)</h4>
<pre>xblock/field_data.py:</pre> 
<pre><code class="python" style="max-height: none;">class FieldData(object):
    @abstractmethod
    def get(self, block, name):
        raise NotImplementedError

    @abstractmethod
    def set(self, block, name, value):
        raise NotImplementedError

    @abstractmethod
    def delete(self, block, name):
        raise NotImplementedError

    @abstractmethod
    def has(self, block, name):
        try:
            self.get(block, name)
            return True
        except KeyError:
            return False

    def set_many(self, block, update_dict):
        for key, value in update_dict.items():
            self.set(block, key, value)</code></pre>
                </section>

                <section>
                    <p class="fragment green">Course components</p>
                    <p class="fragment">are actually</p>
                    <p class="fragment green">StuffWithMixins</p>
                    <p class="fragment">are also</p>
                    <p class="fragment green">XBlocks</p>
                    <p class="fragment">instantiated by</p>
                    <p class="fragment green">a runtime</p>
                    <p class="fragment">with a</p>
                    <p class="fragment green">'field-data' service</p>
                    <p class="fragment">that stores data in</p>
                    <p class="fragment orange">where?</p>
                </section>

                <section>
                    <h2>XBlock storage</h2>
                    <p class="fragment" data-fragment-index="3">"The scope of an xblock field defines the set of xblock instances over which the field takes the same value."</p>
<pre class="fragment" data-fragment-index="1">lms/djangoapps/lms_xblock/field_data.py:
<code class="python">class LmsFieldData(SplitFieldData):
        def __init__(self, authored_data, student_data):
            # See also CmsFieldData in cms/lib/xblock/field_data.py
            ...
            super(LmsFieldData, self).__init__({
                # one block, all users
                Scope.content: authored_data,            # all courses
                Scope.settings: authored_data,           # one course
                Scope.user_state_summary: student_data,  # aggregated user data

                # one user
                Scope.user_state: student_data,          # one block, one course
                Scope.user_info: student_data,           # all blocks
                Scope.preferences: student_data,         # all blocks from same type

                # XBlock-specific properties
                Scope.parent: authored_data,
                Scope.children: authored_data,
            })</code></pre>
<pre><code class="python fragment" data-fragment-index="2">class PollBlock(XBlock):
    answers = List(scope=Scope.settings, help="The answer options on this poll.")
    choice = String(scope=Scope.user_state, help="The student's answer")
    ...</code>
                </section>

                <section>
                    <h2>XBlock storage</h2>
                    <h4>Student data</h4>
                    <div class="fragment">
                        <pre class="large">lms/djangoapps/courseware/module_render.py:</pre>
<pre class="large"><code class="python">def get_module_for_descriptor(user, request, descriptor, ..., course_key, ...):
    return get_module_system_for_user(
        ...
        student_data=KvsFieldData(DjangoKeyValueStore(...))
        ...
    )
</code></pre>
                    </div>
                </section>

                <section>
                    <h2>XBlock storage</h2>
                    <h4>Authored data</h4>
                    <div class="fragment">
                        <pre>lms/envs/common.py:</pre>
                        <pre><code style="max-height: none;">MODULESTORE = {
    'default': {
        'ENGINE': 'xmodule.modulestore.mixed.MixedModuleStore',
        'OPTIONS': {
            'stores': [
                {
                    'NAME': 'split',
                    'ENGINE': 'xmodule.modulestore.split_mongo.split_draft.DraftVersioningModuleStore',
                    ...
                },
                {
                    'NAME': 'draft',
                    'ENGINE': 'xmodule.modulestore.mongo.DraftMongoModuleStore',
                    ...
                },
                {
                    'NAME': 'xml',
                    'ENGINE': 'xmodule.modulestore.xml.XMLModuleStore',
                    ...
                }
            ]
        }
    }
}</code></pre>
                    </div>
                </section>

                <section>
<pre class="large"><code class="python fragment"># These are the Mixins that should be added to every XBlock.
# This should be moved into an XBlock Runtime/Application object
# once the responsibility of XBlock creation is moved out of modulestore</code></pre>
<ol>
    <li class="fragment">What is an "XBlock"?</li>
    <li class="fragment">What is an "XBlock Runtime/Application"?</li>
    <li class="fragment green">What is a "modulestore"?</li>
</ol>
                </section>

                <section data-state="xwars" data-background-image="./img/alongtimeago.png">
                </section>

                <section>
                    <section>
                        <h2>XModules vs XBlocks</h2>
                        <div class="fragment">
                            <p>Introduction of XBlocks:</p>
    <pre class="large"><code class="diff">commit 789ac3fc875aa26380fc7f0865dc5c89a7359473
    Author: Calen Pennington &lt;calen.pennington@gmail.com&gt;
    Date:   Fri Jan 4 16:19:58 2013 -0500

        Use the XBlock library as the base for XModule, so that we can
        incrementally rely on more and more of the XBlock api</code></pre>
                        </div>

                    </section>
                    <section>
                        <h2>XModules vs XBlocks</h2>
                        <p>Introduction of XBlocks:</p>
                        <pre class="large"><code class="bash"># bisect from latest release to first commit
$ git bisect start named-release/dogwood.3 cc1de22e2
$ git bisect run ./bisect.sh
$ cat ./bisect.sh
#! /bin/bash
if [ "$(git grep -i xblock | wc -l)" -le "10" ]; then
    exit 0
else
    exit 1
fi</code></pre>
                    </section>
                </section>

                <section>
                    <h4>XModules (deprecated)</h4>
<div class="fragment">
<p>XModuleDescriptor instantiation:</p>
<pre style="font-size: 100%">
ModuleSystem <i class="fa fa-cogs"></i> ------------- <i class="fa fa-chevron-right"></i> |
<i class="fa"></i><i class="fa"></i>                             | <i class="fa fa-cube"></i>  XModuleDescriptor
Modulestore  <i class="fa fa-database"></i> ------------- <i class="fa fa-chevron-right"></i> |
(author data)
</pre>
</div>

<div class="fragment">
<p>Bind XModuleDescriptor to user:</p>
<pre style="font-size: 100%">
ModuleSystem <i class="fa fa-cogs"></i> ------------- <i class="fa fa-chevron-right"></i> |
<i class="fa"></i><i class="fa"></i>                             |
Modulestore  <i class="fa fa-database"></i> ------------- <i class="fa fa-chevron-right"></i> |
(authored data)<i class="fa"></i><i class="fa"></i>              |
<i class="fa"></i><i class="fa"></i>                             | <i class="fa fa-cubes"></i>  XModule
Modulestore  <i class="fa fa-database"></i> ------------- <i class="fa fa-chevron-right"></i> |
(student data) <i class="fa"></i><i class="fa"></i>              |
<i class="fa"></i><i class="fa"></i>                             |
Student      <i class="fa fa-user"></i> ------------- <i class="fa fa-chevron-right"></i> |
</pre>
</div>
                </section>

                <section>
                    <h4>XBlock SDK</h4>
<div class="fragment">
<p>XBlock instantiation:</p>
<pre style="font-size: 100%">
Runtime    <i class="fa fa-cogs"></i> --------------- <i class="fa fa-chevron-right"></i> |
<i class="fa"></i><i class="fa"></i>                             |
Field data <i class="fa fa-database"></i> --------------- <i class="fa fa-chevron-right"></i> |
(authored data)<i class="fa"></i><i class="fa"></i>              |
<i class="fa"></i><i class="fa"></i>                             | <i class="fa fa-cubes"></i>  XBlock
Field data <i class="fa fa-database"></i> --------------- <i class="fa fa-chevron-right"></i> |
(student data) <i class="fa"></i><i class="fa"></i>              |
<i class="fa"></i><i class="fa"></i>                             |
Student    <i class="fa fa-user"></i> --------------- <i class="fa fa-chevron-right"></i> |
</pre>
</div>
                </section>

                <section>
                    <h4>Open edX XBlocks (backward-compatible)</h4>
<div class="fragment">
<p>XBlock instantiation:</p>
<pre style="font-size: 100%">
Runtime    <i class="fa fa-cogs"></i> --------------- <i class="fa fa-chevron-right"></i> |
<i class="fa"></i><i class="fa"></i>                             | <i class="fa fa-cube"></i>  XBlock (partially working)
Field data <i class="fa fa-database"></i> --------------- <i class="fa fa-chevron-right"></i> |
(authored data)
</pre>
</div>

<div class="fragment">
<p>Bind XBlock to user:</p>
<pre style="font-size: 100%">
Runtime    <i class="fa fa-cogs"></i> --------------- <i class="fa fa-chevron-right"></i> |
<i class="fa"></i><i class="fa"></i>                             |
Field data <i class="fa fa-database"></i> --------------- <i class="fa fa-chevron-right"></i> |
(authored data)<i class="fa"></i><i class="fa"></i>              |
<i class="fa"></i><i class="fa"></i>                             | <i class="fa fa-cubes"></i>  XBlock
Field data <i class="fa fa-database"></i> --------------- <i class="fa fa-chevron-right"></i> |
(student data) <i class="fa"></i><i class="fa"></i>              |
<i class="fa"></i><i class="fa"></i>                             |
Student    <i class="fa fa-user"></i> --------------- <i class="fa fa-chevron-right"></i> |
</pre>
</div>
                </section>

                <section>
                    <h2>The LMS/CMS runtimes</h2>
                    <div class="fragment"><pre class="large">lms/djangoapps/lms_xblock/runtime.py:</pre>
<pre class="large"><code class="python">class LmsModuleSystem(ModuleSystem):
    ...</code></pre></div>
                    <div class="fragment"><pre class="large">cms/djangoapps/contentstore/views/preview.py:</pre>
<pre class="large"><code class="python">class PreviewModuleSystem(ModuleSystem):
    ...</code></pre></div>
                    <div class="fragment"><pre class="large">common/lib/xmodule/xmodule/x_module.py:</pre>
<pre class="large"><code class="python">class ModuleSystem(..., xblock.runtime.Runtime):
    ...</code></pre></div>
                </section>

                <section>
                    <h2>The LMS/CMS runtimes</h2>
                    <h4>Adding new runtime services</h4>
                    <pre class="large">lms/djangoapps/courseware/module_render.py:</pre>
<pre><code class="python">system = LmsModuleSystem(
    ...,
    services={
        'i18n':  ModuleI18nService(),
        'fs': FSService(),
        'field-data': ...,
    },
    ...
)</code></pre>
                </section>

                <section>
                    <h2>The LMS/CMS runtimes</h2>
                    <h4>Adding new runtime services</h4>
                    <pre class="large">lms/djangoapps/lms_xblock/runtime.py:</pre>
<pre><code class="python">class LmsModuleSystem(ModuleSystem):
    # settings.LMS_RUNTIME_SERVICES = {
    #    "myservice": callable,
    #    ...
    # }
    def __init__(self, ..., services, ...):
        for service_name, callable in settings.LMS_RUNTIME_SERVICES.items():
            if service_name not in services:
                services[service_name] = callable()
        ...
</code></pre>
                </section>

                <section>
                </section>

                <section>
                    <h3>Get in touch</h3>
                    <div class="table" style="width: 100%;">
                        <div class="table-row">
                            <div class="table-cell">
                                <img src="./img/regis.png" alt="Régis">
                                <p class="sidespace" style="font-size: 85%;">Régis Behmo<br>regis@fun-mooc.fr</p>
                            </div>
                            <div class="table-cell sidespace">
                                <img src="./img/richard.png" alt="Richard">
                                <p class="sidespace" style="font-size: 85%;">Richard Moch<br>richard@fun-mooc.fr</p>
                            </div>
                            <div class="table-cell sidespace">
                                <img src="./img/sylvain.png" alt="Sylvain">
                                <p class="sidespace" style="font-size: 85%;">Sylvain Toé<br>sylvain@fun-mooc.fr</p>
                            </div>
                        </div>
                    </div>
                    <p>Slides available at <br>
                    <a href="https://github.com/regisb/openedx-conference-2016">https://github.com/regisb/openedx-conference-2016</a></p>
                </section>
			</div>
		</div>

        <!--Reveal.js-->
		<script src="lib/js/head.min.js"></script>
		<script src="lib/js/jquery-1.11.3.min.js"></script>
        <script>
            // Define global variables
            REVEAL_WIDTH = 1280;
            REVEAL_HEIGHT = 720;
        </script>
		<script src="js/reveal.js"></script>

        <!--JS plots-->
        <script src="lib/js/d3.v3.min.js"></script>

        <!--Count lines of code-->
        <script src="js/edx-platform-cloc.js"></script>
        <script>
            clocEdxPlatform("#edx-platform-cloc");
            clocEdxPlatform("#lms-platform-cloc", 0);
            clocEdxPlatform("#cms-platform-cloc", 2);
            clocEdxPlatform("#common-platform-cloc", 1);
        </script>

		<script>
			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: false,
				progress: true,
				history: true,
                slideNumber: true,

                width: REVEAL_WIDTH,
                height: REVEAL_HEIGHT,

				transition: 'fade', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});
		</script>

        <script>
            Reveal.addEventListener('xwars', function() {
                var currentState = Reveal.getState();
                var titleCrawl = function() {
                    // Star Wars title effect
                    var initialTime = new Date()
                    var width = 6820;
                    var height = 720;
                    var initialDistance = 0.1;
                    var speed = 0.6;
                    var dt = 250;
                    var stepCrawl = function() {
                        if(Reveal.getState().indexh != currentState.indexh) {
                            // Remove background on slide change
                            $(".slide-background.present").css("background-image", "");
                            return;
                        }
                        var currentTime = new Date();
                        var ratio = initialDistance / (initialDistance + speed * 0.001 * (currentTime - initialTime))
                        if(ratio*width > 100) {
                            $(".slide-background.present").css(
                                "background-image", "url('./img/thexwars.png')"
                            ).css(
                                "background-size", width*ratio + "px " + height*ratio + "px"
                            );
                            window.setTimeout(stepCrawl, dt);
                        } else {
                            $(".slide-background.present").css("background", "");
                        }
                    }
                    stepCrawl();
                };
                // Wait a couple seconds before crawling
                window.setTimeout(titleCrawl, 2500);
            });
        </script>
	</body>
</html>
